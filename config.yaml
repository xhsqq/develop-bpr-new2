# ============================================
# æç®€é—¨æ§å¤šæ¨¡æ€æ¨èç³»ç»Ÿé…ç½®æ–‡ä»¶
# â­ æ¶æ„ï¼šé—¨æ§è§£è€¦ + ç®€åŒ–é‡å­ + SCMå› æœ
# ============================================

# ============ æ•°æ®é…ç½® ============
data:
  # â­ æ•°æ®é›†é€‰æ‹©ï¼ˆå¯é€‰ï¼šbeauty, games, sportsï¼‰
  category: "beauty"                  # Amazonæ•°æ®é›†ç±»åˆ«

  # æ•°æ®ç›®å½•
  raw_dir: "data/raw"                 # åŸå§‹æ•°æ®ç›®å½•
  processed_dir: "data/processed"     # é¢„å¤„ç†åæ•°æ®ç›®å½•
  data_dir: "data/processed"          # æ•°æ®ç›®å½•ï¼ˆå®é™…ä½¿ç”¨çš„è·¯å¾„ï¼‰

  # æ•°æ®åŠ è½½ï¼ˆä¸è®­ç»ƒé…ç½®ä¸€è‡´ï¼‰
  batch_size: 128                     # â­â­â­ æ‰¹å¤§å°ï¼š64â†’128ï¼ˆæ›´å¤§batchï¼Œæ›´å¼ºæ­£åˆ™åŒ–ï¼‰
  num_workers: 4                      # æ•°æ®åŠ è½½çº¿ç¨‹æ•°
  shuffle: true                       # æ˜¯å¦æ‰“ä¹±è®­ç»ƒæ•°æ®
  pin_memory: true                    # å›ºå®šå†…å­˜ï¼ˆGPUåŠ é€Ÿï¼‰

  # åºåˆ—é…ç½®
  max_seq_length: 50                  # æœ€å¤§åºåˆ—é•¿åº¦
  min_seq_length: 2                   # æœ€å°åºåˆ—é•¿åº¦

  # K-coreè¿‡æ»¤
  min_interactions: 5                 # æœ€å°äº¤äº’æ¬¡æ•°ï¼ˆç”¨äºk-coreè¿‡æ»¤ï¼‰

# ============ æ¨¡å‹æ¶æ„ ============
model:
  # æ¨¡æ€ç»´åº¦é…ç½®
  modality_dims:
    text: 768                         # BERTæ–‡æœ¬ç‰¹å¾ç»´åº¦
    image: 2048                       # ResNetå›¾åƒç‰¹å¾ç»´åº¦

  # åµŒå…¥ç»´åº¦ â­â­â­â­ ç›®æ ‡500Kä»¥ä¸‹ï¼šæè‡´è½»é‡åŒ–
  item_embed_dim: 16                  # â­â­â­â­ ç‰©å“åµŒå…¥ï¼š32â†’16ï¼ˆ387Kâ†’193Kï¼Œå†å‡50%ï¼‰
  hidden_dim: 16                      # â­â­â­â­ éšè—å±‚ï¼š32â†’16ï¼ˆæè‡´è½»é‡ï¼‰

  # â­ æ”¹è¿›1: æç®€é—¨æ§è§£è€¦ï¼ˆ2ç‹¬ç«‹ + 1é—¨æ§èåˆï¼‰
  # æ–°æ¶æ„ï¼šEmotion(Textç‹¬æœ‰) + Aesthetics(Imageç‹¬æœ‰) + Context(é—¨æ§èåˆText+Image)
  disentangled_dim: 16                # â­â­â­â­ æ¯ä¸ªè§£è€¦ç»´åº¦ï¼š32â†’16ï¼ˆå†å‡50%ï¼‰
  num_disentangled_dims: 3            # è§£è€¦ç»´åº¦æ•°é‡ï¼š3ï¼ˆEmotion/Aesthetics/Contextï¼‰
  
  # è§£è€¦è¡¨å¾å†…éƒ¨é…ç½®
  disentangled:
    encoder_hidden_dims: [64, 32]     # â­â­â­â­ ç¼–ç å™¨ï¼š[128,64]â†’[64,32]ï¼ˆå†å‡50%ï¼‰
    vae_reduction_ratio: 0.5          # VAEå¤´éƒ¨ç»´åº¦ç¼©å‡æ¯”ä¾‹
    attention_dim: 32                 # â­â­â­â­ æ³¨æ„åŠ›ç»´åº¦ï¼š64â†’32ï¼ˆå†å‡50%ï¼‰

  # â­ æ”¹è¿›2: é‡å­ç¼–ç å™¨é…ç½®
  quantum_version: "simplified"       # â­â­ å›é€€ç®€åŒ–ç‰ˆï¼šå¢å¼ºç‰ˆåœ¨å°æ•°æ®é›†ä¸Šè¿‡äºå¤æ‚ï¼Œè®­ç»ƒä¸ç¨³å®š
  num_interests: 2                    # â­â­â­â­ æç®€ï¼š3â†’2ä¸ªå…´è¶£ï¼ˆé™åˆ°æœ€å°‘ï¼‰
  quantum_state_dim: 16               # â­â­â­â­ é‡å­æ€ç»´åº¦ï¼š32â†’16ï¼ˆå†å‡50%ï¼‰
  use_quantum_computing: false        # æ˜¯å¦ä½¿ç”¨çœŸå®é‡å­è®¡ç®—ï¼ˆéœ€è¦qiskitï¼‰
  
  # é‡å­ç¼–ç å™¨å†…éƒ¨é…ç½®
  quantum:
    attention_heads: 1                # â­ æ³¨æ„åŠ›å¤´æ•°ï¼š4â†’1ï¼ˆç®€åŒ–å•å¤´æ³¨æ„åŠ›ï¼‰
    interference_init_std: 0.01       # å¹²æ¶‰çŸ©é˜µåˆå§‹åŒ–æ ‡å‡†å·®
    phase_range: "pi"                 # ç›¸ä½èŒƒå›´: "pi" æˆ– "2pi"
    init_scale: "sqrt"                # åˆå§‹åŒ–ç¼©æ”¾: "sqrt" æˆ– "uniform"

  # åºåˆ—ç¼–ç å™¨é…ç½®
  sequence_encoder:
    num_layers: 1                     # â­ GRUå±‚æ•°ï¼š2â†’1ï¼ˆé™ä½å¤æ‚åº¦ï¼‰
    bidirectional: true               # æ˜¯å¦åŒå‘
    dropout: 0.2                      # â­ åºåˆ—ç¼–ç å™¨dropoutï¼š0.1â†’0.2ï¼ˆå¢å¼ºæ­£åˆ™åŒ–ï¼‰
  
  # å› æœæ¨æ–­é…ç½®
  causal:
    scm_hidden_dim: 16                # â­â­â­â­ SCMéšè—å±‚ï¼š32â†’16ï¼ˆæè‡´è½»é‡ï¼‰
    intervention_types:               # å¹²é¢„ç±»å‹ï¼ˆâ­æ–°æ¶æ„ï¼šContext=é—¨æ§èåˆText+Imageï¼‰
      - "function_to_mean"            # Contextç»´åº¦å‡å€¼å¹²é¢„ï¼ˆå‘åå…¼å®¹åç§°ï¼‰
      - "aesthetics_shift"            # Aestheticsç»´åº¦åç§»å¹²é¢„ï¼ˆImageç‹¬æœ‰ï¼‰
      - "emotion_swap"                # Emotionç»´åº¦äº¤æ¢å¹²é¢„ï¼ˆTextç‹¬æœ‰ï¼‰
    target_ite_magnitude: 0.3         # ç›®æ ‡ITEå¹…åº¦
    uncertainty_dropout: 0.3          # ä¸ç¡®å®šæ€§é‡åŒ–dropout

  # Dropout
  dropout: 0.3                        # â­â­â­ å…¨å±€Dropoutï¼š0.2â†’0.3ï¼ˆå¼ºæ­£åˆ™åŒ–é˜²æ­¢è¿‡æ‹Ÿåˆï¼‰

# ============ æŸå¤±æƒé‡é…ç½® ============
loss:
  # â­ ä¸»æŸå¤±ï¼šBPRï¼ˆæ¨èæŸå¤±ï¼‰
  # è‡ªåŠ¨æƒé‡ä¸º1.0ï¼Œä¸éœ€è¦é…ç½®

  # â­â­â­ æç®€é—¨æ§è§£è€¦ï¼šä¼˜åŒ–åçš„æŸå¤±æƒé‡
  # BPRæŸå¤±ï¼ˆä¸»ä»»åŠ¡ï¼‰â‰ˆ 0.6-0.7ï¼Œè¾…åŠ©æŸå¤±ä¿æŒè¾ƒä½
  alpha_recon: 0.001                  # â­â­â­ é‡æ„æŸå¤±ï¼š0.01â†’0.001ï¼ˆdis_loss=59è¿‡å¤§ï¼Œé™ä½10å€ï¼‰
  alpha_causal: 0.002                 # â­â­ å› æœæŸå¤±ï¼š0.005â†’0.002ï¼ˆè¿›ä¸€æ­¥é™ä½ï¼Œç¡®ä¿BPRä¸»å¯¼ï¼‰
  alpha_diversity: 0.0005             # â­â­ å¤šæ ·æ€§æŸå¤±ï¼š0.001â†’0.0005ï¼ˆé™ä½50%ï¼‰
  # å·²ç§»é™¤ï¼šalpha_orthogonalityï¼ˆæ­£äº¤æ€§æŸå¤±ä¸å†ä½¿ç”¨ï¼‰

  # â­â­â­ ä¿®å¤ï¼šå¯ç”¨KLæ­£åˆ™ï¼ˆVAEå¿…éœ€ï¼Œé˜²æ­¢åéªŒåå¡Œï¼‰
  beta: 0.05                          # â­â­â­ KLæ•£åº¦æƒé‡ï¼š0.05ï¼ˆå¹³è¡¡é‡æ„ä¸æ­£åˆ™åŒ–ï¼‰
  gamma: 0.0                          # ç‹¬ç«‹æ€§æŸå¤±æƒé‡ï¼šç¦ç”¨ï¼ˆé—¨æ§å·²éšå¼è§£è€¦ï¼‰
  use_kl_loss: true                   # â­â­â­ å¯ç”¨KLæŸå¤±ï¼šVAEæ ‡å‡†è®­ç»ƒéœ€è¦
  use_independence_loss: false        # ç¦ç”¨ç‹¬ç«‹æ€§æŸå¤±ï¼šé—¨æ§æœºåˆ¶å·²ç¡®ä¿è§£è€¦
  
  # ğŸ’¡ æ¸è¿›å¼ç­–ç•¥ï¼š
  # é˜¶æ®µ1ï¼ˆåˆæœŸï¼‰ï¼šåªç”¨4ä¸ªæŸå¤± = BPR + Recon + Causal + Diversity
  #   - beta: 0.0, use_kl_loss: false
  # é˜¶æ®µ2ï¼ˆç¨³å®šåï¼‰ï¼šå¦‚æœNDCG@10 > 0.05ä½†æå‡ç¼“æ…¢ï¼Œå¯ä»¥å°è¯•åŠ å…¥KLæ­£åˆ™
  #   - beta: 0.05, use_kl_loss: true
  # é˜¶æ®µ3ï¼ˆè¿‡æ‹Ÿåˆï¼‰ï¼šå¦‚æœè®­ç»ƒé›†>>éªŒè¯é›†ï¼Œå¢å¼ºæ­£åˆ™åŒ–
  #   - beta: 0.1, weight_decay: 0.0005
  
  # é‡å­æŸå¤±å†…éƒ¨æƒé‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
  quantum_weights:
    diversity: 0.7                    # å¤šæ ·æ€§æŸå¤±ï¼ˆæ ¸å¿ƒï¼‰
    # å·²ç§»é™¤ï¼šphaseï¼ˆç›¸ä½æŸå¤±ä¸å†ä½¿ç”¨ï¼‰
  
  # å› æœæŸå¤±å†…éƒ¨æƒé‡ï¼ˆä¸ä»£ç ç¡¬ç¼–ç å¯¹åº”ï¼‰
  causal_weights:
    magnitude: 1.0                    # â­â­ ITEå¹…åº¦æ­£åˆ™ï¼ˆæ ¸å¿ƒï¼‰
    # å·²ç§»é™¤ï¼šmonotonicityï¼ˆç®€åŒ–åä¸å†ä½¿ç”¨ï¼‰
    # å·²ç§»é™¤ï¼šconsistency, orthogonalityï¼ˆä»£ç ç®€åŒ–æ—¶åˆ é™¤ï¼‰

# ============ è®­ç»ƒé…ç½® ============
training:
  # åŸºç¡€é…ç½®ï¼ˆé’ˆå¯¹æç®€é—¨æ§è§£è€¦ä¼˜åŒ–ï¼‰
  batch_size: 128                     # â­â­â­ 128ï¼šæ›´å¤§batchï¼Œå¢å¼ºæ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ
  num_epochs: 100                     # è®­ç»ƒè½®æ•°ï¼š100ï¼ˆå……åˆ†æ”¶æ•›ï¼‰
  learning_rate: 0.001                # â­â­â­ 0.001ï¼šæé«˜10å€ï¼ŒåŠ é€Ÿæ”¶æ•›ï¼ˆä¹‹å‰å¤ªä¿å®ˆï¼‰
  weight_decay: 0.001                 # â­â­â­ 0.001ï¼šå¼ºæ­£åˆ™åŒ–ï¼ˆ0.0001â†’0.001ï¼Œæé«˜10å€ï¼‰

  # å­¦ä¹ ç‡è°ƒåº¦
  lr_scheduler: "cosine"              # Cosineé€€ç«ï¼šå¹³æ»‘è¡°å‡
  lr_warmup_epochs: 5                 # â­â­ é¢„çƒ­è½®æ•°ï¼š10â†’5ï¼ˆé—¨æ§æ¶æ„æ”¶æ•›å¿«ï¼‰
  lr_min: 0.00001                     # æœ€å°å­¦ä¹ ç‡ï¼š1e-5

  # KLé€€ç«ï¼ˆé—¨æ§ELBOä¸“ç”¨ï¼‰
  kl_anneal_epochs: 20                # â­â­ KLé€€ç«ï¼š30â†’20ï¼ˆé—¨æ§æ¶æ„æ›´ç¨³å®šï¼‰

  # ä¼˜åŒ–å™¨
  optimizer: "adamw"                  # AdamWï¼šå¸¦æƒé‡è¡°å‡çš„Adam
  grad_clip: 1.0                      # æ¢¯åº¦è£å‰ªï¼šé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸

  # æ—©åœï¼ˆæ¿€è¿›ç­–ç•¥ï¼‰
  early_stopping:
    patience: 10                      # â­â­ è€å¿ƒå€¼ï¼š15â†’10ï¼ˆé—¨æ§æ¶æ„æ”¶æ•›å¿«ï¼‰
    min_delta: 0.0005                 # æœ€å°æ”¹è¿›ï¼š5e-4

  # æ£€æŸ¥ç‚¹
  save_every: 5                       # æ¯Nè½®ä¿å­˜ä¸€æ¬¡æ¨¡å‹
  checkpoint_dir: "checkpoints"       # æ£€æŸ¥ç‚¹ä¿å­˜ç›®å½•

# ============ è¯„ä¼°é…ç½® ============
evaluation:
  # Top-KæŒ‡æ ‡
  top_k: [5, 10, 20]                  # è¯„ä¼°çš„Kå€¼

  # è¯„ä¼°æŒ‡æ ‡
  metrics:
    - "recall"                        # å¬å›ç‡
    - "ndcg"                          # NDCG
    - "hit_rate"                      # å‘½ä¸­ç‡
    - "mrr"                           # MRR

  # è¯„ä¼°é¢‘ç‡
  eval_every: 1                       # æ¯Nè½®è¯„ä¼°ä¸€æ¬¡
  filter_train_items: true            # è¯„ä¼°æ—¶è¿‡æ»¤è®­ç»ƒç‰©å“ï¼Œé¿å…æ³„éœ²

  # æµ‹è¯•æ—¶çš„æ‰¹å¤§å°ï¼ˆå¯ä»¥æ›´å¤§ä»¥åŠ é€Ÿï¼‰
  test_batch_size: 512

# ============ æ¶ˆèå®éªŒé…ç½® ============
ablation:
  # æ˜¯å¦å¯ç”¨å„ä¸ªæ¨¡å—
  enable_disentangled: true           # â­ æ”¹è¿›1: ç»´åº¦ç‰¹å®šå¤šæ¨¡æ€èåˆ
  enable_quantum: true                # â­ æ”¹è¿›2: é‡å­ç¼–ç å™¨
  enable_causal: true                 # â­ æ”¹è¿›3: SCMå› æœæ¨æ–­

  # æ¶ˆèå®éªŒçš„æŸå¤±æƒé‡è¦†ç›–
  # å½“ç¦ç”¨æŸä¸ªæ¨¡å—æ—¶ï¼Œå…¶å¯¹åº”çš„æŸå¤±æƒé‡ä¼šè‡ªåŠ¨è®¾ä¸º0

# ============ æ—¥å¿—å’Œå¯è§†åŒ– ============
logging:
  # TensorBoard
  use_tensorboard: true               # æ˜¯å¦ä½¿ç”¨TensorBoard
  log_dir: "runs"                     # TensorBoardæ—¥å¿—ç›®å½•

  # æ—¥å¿—é¢‘ç‡
  log_every: 100                      # æ¯Nä¸ªbatchè®°å½•ä¸€æ¬¡

  # å¯è§†åŒ–
  visualize_attention: false          # æ˜¯å¦å¯è§†åŒ–æ³¨æ„åŠ›æƒé‡ï¼ˆè¾ƒæ…¢ï¼‰
  visualize_quantum: false            # æ˜¯å¦å¯è§†åŒ–é‡å­æ€ï¼ˆè¾ƒæ…¢ï¼‰

# ============ ç¡¬ä»¶é…ç½® ============
device:
  use_gpu: true                       # æ˜¯å¦ä½¿ç”¨GPU
  gpu_ids: [0]                        # GPU IDåˆ—è¡¨
  mixed_precision: false              # æ˜¯å¦ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼ˆéœ€è¦GPUï¼‰

# ============ éšæœºç§å­ ============
seed: 42                              # éšæœºç§å­ï¼ˆå¯é‡å¤æ€§ï¼‰

# ============ é«˜çº§é…ç½® ============
advanced:
  # æ¸©åº¦å‚æ•°ï¼ˆæ¨èæ‰“åˆ†ï¼‰
  temperature: 0.5                    # â­â­ æ¸©åº¦0.5ï¼šå¹³è¡¡åŒºåˆ†åº¦ä¸ç¨³å®šæ€§
  use_config_temperature: true        # ä»configè¯»å–temperature

  # è´Ÿé‡‡æ ·ï¼ˆBPRå¯¹æ¯”å­¦ä¹ ï¼‰â­â­â­ ä¿®å¤è®­ç»ƒ-è¯„ä¼°ä¸ä¸€è‡´é—®é¢˜
  num_negatives: 100                  # â­â­â­ 100ä¸ªè´Ÿæ ·æœ¬ï¼šå¹³è¡¡Gap(121x)å’Œè®¡ç®—æˆæœ¬(20x)
  use_config_negatives: true          # ä»configè¯»å–num_negatives
  
  # ğŸ¯ è®­ç»ƒ-è¯„ä¼°ä¸€è‡´æ€§åˆ†æï¼š
  # è¯„ä¼°æ—¶ï¼šä»12101ä¸ªç‰©å“ä¸­é€‰Top-10ï¼ˆå…¨åº“ï¼‰
  # è®­ç»ƒæ—¶ï¼š1æ­£ + Kè´Ÿï¼ˆå€™é€‰é›†ï¼‰
  # Gap = 12101 / (1+K)
  # 
  # K=4:    Gap=2420x  âŒ ä¸¥é‡ä¸ä¸€è‡´
  # K=100:  Gap=121x   âœ… å¯æ¥å—ï¼ˆæœ¬è®¾ç½®ï¼‰
  # K=300:  Gap=40x    âœ… æ›´å¥½ï¼ˆä½†è®¡ç®—é‡â†‘3å€ï¼‰
  # K=1000: Gap=12x    âœ… ç†æƒ³ï¼ˆä½†è®¡ç®—é‡â†‘10å€ï¼‰
  #
  # ğŸ’¡ æ¸è¿›å¼ç­–ç•¥ï¼š
  # é˜¶æ®µ1ï¼šnum_negatives=100ï¼ˆéªŒè¯æ¶æ„ï¼Œé¢„æœŸNDCG@10: 0.03-0.05ï¼‰
  # é˜¶æ®µ2ï¼šnum_negatives=300ï¼ˆå……åˆ†è®­ç»ƒï¼Œé¢„æœŸNDCG@10: 0.06-0.08ï¼‰
  # é˜¶æ®µ3ï¼šnum_negatives=1000ï¼ˆå‘è¡¨çº§ï¼Œé¢„æœŸNDCG@10: 0.08-0.10ï¼‰

  # å› æœæ¨æ–­é…ç½®
  num_mc_samples: 10                  # â­â­ MCé‡‡æ ·ï¼š10æ¬¡ï¼ˆå¹³è¡¡ç²¾åº¦ä¸é€Ÿåº¦ï¼‰
  use_config_mc_samples: true         # ä»configè¯»å–
  num_ensembles: 3                    # â­â­ é›†æˆæ•°ï¼š3ï¼ˆé™ä½è®¡ç®—é‡ï¼‰
  target_ite: 0.3                     # â­â­ ç›®æ ‡ITEï¼š0.4â†’0.3ï¼ˆæ›´ä¿å®ˆçš„å¹²é¢„å¼ºåº¦ï¼‰

  # é‡å­æµ‹é‡
  quantum_measurement_samples: 1      # é‡å­æµ‹é‡é‡‡æ ·æ¬¡æ•°ï¼ˆé»˜è®¤1å³å¯ï¼‰

# ============ å®éªŒè¿½è¸ª ============
experiment:
  name: "gated-multimodal-rec"        # â­â­ å®éªŒåç§°ï¼šé—¨æ§å¤šæ¨¡æ€æ¨è
  tags:
    - "gated-disentangling"           # â­ æç®€é—¨æ§è§£è€¦ï¼ˆ2ç‹¬ç«‹+1èåˆï¼‰
    - "simplified-quantum"            # â­ ç®€åŒ–ç‰ˆé‡å­ç¼–ç å™¨ï¼ˆ3å…´è¶£ï¼‰
    - "scm-causal"                    # SCMå› æœæ¨æ–­

  notes: |
    â­ æç®€é—¨æ§æ¶æ„ v1.0ï¼š
    1. é—¨æ§è§£è€¦ï¼šEmotion(Text) + Aesthetics(Image) + Context(é—¨æ§èåˆ)
    2. ç®€åŒ–é‡å­ï¼š3å…´è¶£æ€ + attentionæœºåˆ¶
    3. å› æœæ¨æ–­ï¼šPearlä¸‰æ­¥æ³• + 3ç»´åº¦å¹²é¢„
    
    ä¼˜åŒ–è¦ç‚¹ï¼š
    - Beta=0.05ï¼ˆé€‚åº¦KLæ­£åˆ™ï¼‰
    - è´Ÿé‡‡æ ·=4ï¼ˆå……åˆ†å¯¹æ¯”å­¦ä¹ ï¼‰
    - Patience=10ï¼ˆå¿«é€Ÿæ”¶æ•›ï¼‰
